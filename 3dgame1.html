<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Game - Enhanced Platforms</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; }
        #crosshair {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 8px;
            height: 8px;
            background-color: white;
            border-radius: 50%;
            pointer-events: none;
            transform: translate(-50%, -50%);
        }
        #instructions {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-family: Arial, sans-serif;
            font-size: 18px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border-radius: 8px;
            display: none;
        }
    </style>
</head>
<body>
    <div id="crosshair"></div>
    <div id="instructions">Click to start</div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // Scene, camera, renderer setup
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Lighting
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5); // Soft ambient light
        const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
        directionalLight.position.set(10, 10, 10);
        scene.add(ambientLight, directionalLight);

        // Metal texture for platforms
        const textureLoader = new THREE.TextureLoader();
        const metalTexture = textureLoader.load('data:image/jpeg;base64,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'); // Metal texture URL
        const metalMaterial = new THREE.MeshStandardMaterial({ map: metalTexture });

        // Create platforms
        const platforms = [];
        const platformGeometry = new THREE.BoxGeometry(5, 1, 5);

        for (let i = 0; i < 15; i++) {
            const platform = new THREE.Mesh(platformGeometry, metalMaterial);
            platform.position.set(
                Math.random() * 20 - 10,
                i * 4,
                Math.random() * 20 - 10
            );
            platform.castShadow = true;
            platform.receiveShadow = true;
            scene.add(platform);
            platforms.push(platform);
        }

        // Spikes for obstacles
        const spikeGeometry = new THREE.ConeGeometry(0.5, 2, 8);
        const spikeMaterial = new THREE.MeshStandardMaterial({ color: 0xff0000 });

        for (let i = 0; i < 20; i++) {
            const spike = new THREE.Mesh(spikeGeometry, spikeMaterial);
            spike.rotation.x = Math.PI; // Point spikes upward
            spike.position.set(
                Math.random() * 20 - 10,
                Math.random() * 50,
                Math.random() * 20 - 10
            );
            scene.add(spike);
        }

        // Player setup
        const player = new THREE.Object3D();
        player.add(camera);
        camera.position.set(0, 1.6, 0);
        scene.add(player);

        let velocityY = 0;
        const gravity = -0.02;
        const jumpStrength = 0.3;
        let isGrounded = false;

        // Pointer lock setup
        const instructions = document.getElementById("instructions");
        const canvas = renderer.domElement;

        function enablePointerLock() {
            canvas.requestPointerLock();
        }

        document.addEventListener("click", () => {
            instructions.style.display = "none";
            enablePointerLock();
        });

        document.addEventListener("pointerlockchange", () => {
            if (document.pointerLockElement !== canvas) {
                instructions.style.display = "block";
            }
        });

        // Movement controls
        const keys = {};
        document.addEventListener("keydown", (e) => keys[e.key] = true);
        document.addEventListener("keyup", (e) => keys[e.key] = false);

        function movePlayer() {
            const speed = 0.1;
            const forward = new THREE.Vector3(
                Math.sin(player.rotation.y),
                0,
                Math.cos(player.rotation.y)
            ).normalize();

            const right = new THREE.Vector3(
                Math.sin(player.rotation.y + Math.PI / 2),
                0,
                Math.cos(player.rotation.y + Math.PI / 2)
            ).normalize();

            if (keys["w"]) player.position.add(forward.multiplyScalar(-speed));
            if (keys["s"]) player.position.add(forward.multiplyScalar(speed));
            if (keys["a"]) player.position.add(right.multiplyScalar(-speed));
            if (keys["d"]) player.position.add(right.multiplyScalar(speed));
        }

        function checkCollision() {
            for (const platform of platforms) {
                const platformBox = new THREE.Box3().setFromObject(platform);
                const playerBox = new THREE.Box3().setFromCenterAndSize(
                    player.position.clone().setY(player.position.y - 0.8),
                    new THREE.Vector3(0.5, 1.6, 0.5)
                );

                if (platformBox.intersectsBox(playerBox)) {
                    player.position.y = platformBox.max.y + 1.6;
                    isGrounded = true;
                    return true;
                }
            }
            isGrounded = false;
            return false;
        }

        function applyGravity() {
            velocityY += gravity;
            player.position.y += velocityY;

            if (checkCollision()) velocityY = 0;
            if (player.position.y < -10) player.position.set(0, 5, 0); // Respawn
        }

        function handleJump() {
            if (keys[" "] && isGrounded) {
                velocityY = jumpStrength;
                isGrounded = false;
            }
        }

        // Animate
        function animate() {
            requestAnimationFrame(animate);
            movePlayer();
            handleJump();
            applyGravity();
            renderer.render(scene, camera);
        }

        animate();
    </script>
</body>
</html>
